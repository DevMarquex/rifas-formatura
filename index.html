<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Rifas da Formatura</title>
<style>
  /* Grid de rifas */
  .rifa {
    width: 50px;
    height: 40px;
    margin: 4px;
    border-radius: 8px;
    cursor: pointer;
    font-weight: 900;
    display: flex;
    justify-content: center;
    align-items: center;
    user-select: none;
  }
  .disponivel {
    background: #87ceeb;
    color: #0d0d0d;
  }
  .selecionada {
    background: #7ac1b9;
    color: white;
    border: 2px solid #0d0d0d;
  }
  .reservada {
    background: #fddede;
    color: #900000;
    cursor: default;
  }

  #rifas-container {
    max-width: 720px;
    margin: 20px auto;
    display: flex;
    flex-wrap: wrap;
    gap: 4px;
  }

  /* Botão flutuante comprar */
  #comprar-btn {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #4caf50;
    color: white;
    padding: 14px 24px;
    border-radius: 50px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 12px rgba(0,0,0,0.25);
    display: none;
    z-index: 1100;
  }

  /* Popup QR PIX fixo */
  #qr-popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    padding: 25px 30px;
    box-shadow: 0 8px 25px rgba(0,0,0,0.3);
    border-radius: 14px;
    z-index: 1200;
    max-width: 320px;
    text-align: center;
    display: none;
  }
  #qr-popup img {
    width: 230px;
    margin: 15px 0;
  }
  #qr-popup button {
    background: #d32f2f;
    border: none;
    color: white;
    font-weight: 700;
    font-size: 16px;
    padding: 10px 20px;
    border-radius: 12px;
    cursor: pointer;
  }

  #overlay {
    display: none;
    position: fixed;
    top:0; left:0; right:0; bottom:0;
    background: rgba(0,0,0,0.5);
    z-index: 1199;
  }

  /* Painel admin simples para atualizar rifas reservadas */
  #admin-panel {
    max-width: 720px;
    margin: 40px auto;
    padding: 20px;
    border: 2px solid #999;
    border-radius: 12px;
  }
  #admin-panel textarea {
    width: 100%;
    height: 80px;
    font-family: monospace;
    font-size: 16px;
  }
  #admin-panel button {
    margin-top: 10px;
    background-color: #0052cc;
    border: none;
    color: white;
    font-weight: 700;
    font-size: 16px;
    padding: 10px 20px;
    border-radius: 12px;
    cursor: pointer;
  }
</style>
</head>
<body>

<h1 style="text-align:center;">Rifas da Formatura</h1>

<div id="rifas-container"></div>

<button id="comprar-btn">Comprar Rifas Selecionadas</button>

<div id="overlay"></div>

<div id="qr-popup">
  <h3>Pagamento via PIX</h3>
  
  <img id="qr-code-img" alt="QR Code PIX" />
  <p><b>Chave PIX:</b> <span id="pix-key"></span></p>
  <button onclick="fecharQrPopup()">Fechar</button>
</div>

<!-- Painel admin para atualizar rifas reservadas -->
<div id="admin-panel">
  <h2>Painel Administrativo - Atualizar Rifas Vendidas</h2>
  <p>Informe os números das rifas vendidas, separados por vírgula.</p>
  <textarea id="rifas-vendidas-input" placeholder="Ex: 0001,0002,0045"></textarea>
  <button onclick="atualizarRifasReservadas()">Atualizar Rifas</button>
  <p><small>Este painel deve ser usado apenas por quem gerencia as rifas.</small></p>
</div>

<script>
  const valorRifa = 10.00; // Valor por rifa
  const totalRifas = 2000;

  // Chave PIX da sua namorada (a que vai aparecer no QR Code)
  // Pode ser o payload gerado por algum gerador de QR Code PIX, ou a chave simples (CPF, e-mail, celular)
  // Vou usar uma chave exemplo abaixo, você troca pela real
  const pixKey = "86385399087"; // troque aqui!

  const rifasReservadas = {
    "0975": "Mara Marques",
    "0830": "Mara Marques",
    "0793": "Thiago Marques",
    "0640": "Mara Marques",
    "0624": "Thiago Marques",
    "0619": "Mara Marques",
    "0575": "Mara Marques",
    "0509": "Thiago Marques",
    "0467": "Thiago Marques",
    "0419": "Mara Marques",
    "0412": "Thiago Marques",
    "0305": "Thiago Marques",
    "0290": "Thiago Marques",
    "0270": "Mara Marques",
    "1369": "Lucas",
    "1362": "Lucas",
    "1359": "Lucas",
    "1347": "Lucas",
    "1342": "Lucas",
    "1337": "Lucas",
    "1333": "Lucas",
    "1331": "Lucas",
    "1317": "Lucas",
    "1318": "Lucas",
    "1319": "Lucas",
    "1320": "Lucas",
    "1321": "Lucas",
    "1322": "Lucas",
    "1323": "Lucas",
    "1324": "Lucas",
    "1325": "Lucas",
    "1199": "Ana",
    "1194": "Lucas",
    "1117": "Lucas",
    "1174": "Lucas",
    "1135": "Mariana",
    "1127": "Lucas",
    "1126": "Lucas",
    "1125": "Lucas",
    "1124": "Lucas",
    "1123": "Lucas",
    "1113": "Ana",
    "1101": "Lucas",
    "1245": "Lucas",
    "1300": "Lucas",
    "1301": "Lucas",
    "1302": "Lucas",
    "1303": "Lucas",
    "1304": "Lucas",
    "1305": "Lucas",
    "1306": "Lucas",
    "1307": "Lucas",
    "1308": "Lucas",
    "1309": "Lucas",
    "1310": "Lucas",
    "1311": "Lucas",
    "1313": "Lucas",
    "1399": "Ana",
    "1380": "Lucas",
    "0906": "Lucas",
    "0603": "Lucas",
    "0268": "Thiago Marques",
    "0237": "Thiago Marques",
    "0209": "Thiago Marques",
    "0193": "Thiago Marques",
    "0188": "Thiago Marques",
    "0180": "Mara Marques",
    "0175": "Mara Marques",
    "0153": "Thiago Marques",
    "0127": "Thiago Marques",
    "0107": "Lorenzo Santos",
    "0101": "Thiago Marques",
    "0089": "Thiago Marques",
    "0070": "Mara Marques",
    "0037": "Thiago Marques",
    "0014": "Thiago Marques",
    "1377": "Kimberly Iwanczuk",
    "1999": "Kimberly Iwanczuk",
    "1992": "Kimberly Iwanczuk",
    "0013": "Allan Pereira",
    "0022": "Allan Pereira", 
    "0007": "Henrique Santos",
    "0777": "Henrique Santos", 
    "0500": "Murilo Bellon",
    "0502": "Murilo Bellon",
    "0503": "Murilo Bellon",
    "0504": "Murilo Bellon",
    "0009": "Rita Martins",
  }; // objeto que guarda rifas vendidas e quem comprou (pode ficar vazio)

  // elementos
  const container = document.getElementById('rifas-container');
  const comprarBtn = document.getElementById('comprar-btn');
  const overlay = document.getElementById('overlay');
  const qrPopup = document.getElementById('qr-popup');
  const qrCodeImg = document.getElementById('qr-code-img');
  const pixKeySpan = document.getElementById('pix-key');
  const rifasVendidasInput = document.getElementById('rifas-vendidas-input');

  let selecionadas = new Set();

  function atualizarComprarBtn() {
    if (selecionadas.size > 0) {
      comprarBtn.style.display = 'block';
      comprarBtn.textContent = `Comprar ${selecionadas.size} rifa(s) por R$ ${(selecionadas.size * valorRifa).toFixed(2)}`;
    } else {
      comprarBtn.style.display = 'none';
    }
  }

  function toggleRifaSelecionada(div, numStr) {
    if (rifasReservadas[numStr]) return; // não pode selecionar rifas vendidas

    if (selecionadas.has(numStr)) {
      selecionadas.delete(numStr);
      div.classList.remove('selecionada');
    } else {
      selecionadas.add(numStr);
      div.classList.add('selecionada');
    }
    atualizarComprarBtn();
  }

  function criarRifasGrid() {
    container.innerHTML = '';
    for(let i=1; i<=totalRifas; i++) {
      const numStr = i.toString().padStart(4, '0');
      const div = document.createElement('div');
      div.classList.add('rifa');
      if(rifasReservadas[numStr]) {
        div.classList.add('reservada');
        div.textContent = numStr;
        div.title = `Vendida`;
      } else {
        div.classList.add('disponivel');
        div.textContent = numStr;
        div.title = "Disponível";
        div.addEventListener('click', () => toggleRifaSelecionada(div, numStr));
      }
      container.appendChild(div);
    }
  }

  // Gera QR Code simples (estático) para a chave PIX usando API gratuita (exemplo: https://goqr.me/api/)
  function gerarQrCode() {
    // PIX payload simples para pagar valor (não obrigatório valor fixo)
    // Pode gerar QR Code só da chave PIX (o pagador informa valor)
    // Ou gerar payload mais complexo via geradores específicos (não implementado aqui)
    const pixPayload = `00020126360014BR.GOV.BCB.PIX0136${pixKey}0208Compra rifas520400005303986540${(valorRifa * selecionadas.size).toFixed(2).replace('.', '')}5802BR5925Rifas Formatura 6009Sao Paulo61080540900062070503***6304`;

    // Pra simplificar, só QR da chave PIX (você pode usar uma imagem QR pronta, ou serviço externo)
    // Usaremos API pública de QR code, só para a chave PIX

    // Se quiser usar payload real, terá que usar gerador específico ou sua namorada gera QR e salva imagem

    // Aqui só geramos QR da chave PIX simples
    const url = `https://api.qrserver.com/v1/create-qr-code/?size=230x230&data=PIX:${pixKey}`;
    return url;
  }

  comprarBtn.addEventListener('click', () => {
    if (selecionadas.size === 0) return;

    // Mostrar popup QR Code fixo da chave PIX
    const qrUrl = gerarQrCode();
    qrCodeImg.src = qrUrl;
    pixKeySpan.textContent = pixKey;

    overlay.style.display = 'block';
    qrPopup.style.display = 'block';
  });

  function fecharQrPopup() {
    overlay.style.display = 'none';
    qrPopup.style.display = 'none';
  }

  overlay.addEventListener('click', fecharQrPopup);

  // Atualiza rifas reservadas manualmente
  function atualizarRifasReservadas() {
    const texto = rifasVendidasInput.value.trim();
    if (!texto) {
      alert("Informe pelo menos um número de rifa vendido.");
      return;
    }

    const nums = texto.split(',').map(n => n.trim().padStart(4, '0'));
    nums.forEach(n => {
      rifasReservadas[n] = true;
      selecionadas.delete(n);
    });

    criarRifasGrid();
    atualizarComprarBtn();
    rifasVendidasInput.value = "";
    alert("Rifas atualizadas com sucesso!");
  }

  // Inicializar grid
  criarRifasGrid();
</script>
</body>
</html>
